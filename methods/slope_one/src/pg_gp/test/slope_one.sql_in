m4_include('SQLCommon.m4')

CREATE TABLE wikipedia_slope_one_train_table (
  John INT,
  Mark INT,
  Lucy INT
) m4_ifdef(`__GREENPLUM__',`DISTRIBUTED RANDOMLY');

INSERT INTO wikipedia_slope_one_train_table VALUES
  (3,4,2),
  (2,NULL,5)
;

CREATE TABLE wikipedia_slope_one_test_table (
  John INT,
  Mark INT
) m4_ifdef(`__GREENPLUM__',`DISTRIBUTED RANDOMLY');

INSERT INTO wikipedia_slope_one_test_table VALUES
  (5,3)
;

SELECT MADLIB_SCHEMA.slope_one_train('Lucy','John,Mark',
          'wikipedia_slope_one_train_table','wikipedia_slope_one_model_table');

SELECT MADLIB_SCHEMA.slope_one_predict('Lucy','John,Mark',
          'wikipedia_slope_one_train_table','wikipedia_slope_one_model_table',
          'wikipedia_slope_one_out_table');

SELECT assert(
  John=5 AND
  Mark=3 AND
  relative_error(Lucy,4.333333) < 1e-4,
  'Slope One (Wikipedia test): Wrong results'
) FROM wikipedia_slope_one_out_table;
 
