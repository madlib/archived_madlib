/* ----------------------------------------------------------------------- *//**
 *
 * @file train_data_loader.sql_in
 *
 * @brief create all the necessary tables to store the training data, then use the linear chain conditional 
 *        random field to train the data
 * @param datapath the path to the nlp training data
 * @date May 2012
 * @sa For an introduction to the text feature extraction, see the module
 *     description \ref grp_nlp
 *
 *//* ----------------------------------------------------------------------- */

m4_include(`SQLCommon.m4')
CREATE OR REPLACE FUNCTION MADLIB_SCHEMA.load_nlp_traindata(datapath text) RETURNS void AS
$$      
	# import label data to the database
	query = "DROP TABLE IF EXISTS MADLIB_SCHEMA.nlp_label CASCADE;" + \
	        "CREATE TABLE MADLIB_SCHEMA.nlp_label(id integer,label text);" + \
	        "COPY MADLIB_SCHEMA.nlp_label(id,label) FROM '" + datapath + "/nlp_label.tab'";
	plpy.execute(query);

        # import regex table to the database
	query = "DROP TABLE IF EXISTS MADLIB_SCHEMA.nlp_regex CASCADE;" + \
                "CREATE TABLE MADLIB_SCHEMA.nlp_regex (pattern text,name text);" + \
	        "COPY MADLIB_SCHEMA.nlp_regex(pattern,name) FROM '" + datapath + "/nlp_regex.tab'";
	plpy.execute(query);
    
        # import training data to the database
        query = "DROP TABLE IF EXISTS MADLIB_SCHEMA.nlp_traindata CASCADE;" + \
                "CREATE TABLE MADLIB_SCHEMA.nlp_traindata(start_pos integer,doc_id integer,seg_text text,label integer,max_pos integer);" + \
	        "COPY MADLIB_SCHEMA.nlp_traindata(start_pos,doc_id,seg_text,label,max_pos) FROM '" + datapath + "/nlp_traindata.tab'";
        plpy.execute(query);

$$ LANGUAGE plpythonu STRICT;
