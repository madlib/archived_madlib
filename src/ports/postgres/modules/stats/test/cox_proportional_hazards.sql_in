/* -----------------------------------------------------------------------------
 * Cox proportional hazard survival regression
 *
 * Example taken from:
 * http://www.sph.emory.edu/~cdckms/CoxPH/prophaz2.html
 * -------------------------------------------------------------------------- 
 * Expected output
 *
 * -2 Log Likelihood =   238.3605 (Null Model)
 * -2 Log Likelihood =   201.1290
 * -2 Log Likelihood =   201.1076
 * -2 Log Likelihood =   201.1076 (Converged)
 * Overall Model Fit...
 *   Chi Square=   37.2529;  df=2;  p=    0.0000
 *
 * Coefficients, Standard Errors, Significance, and 95% Confidence Intervals
 *    Var        Coeff.    StdErr       p       Lo95%     Hi95%
 *      1        0.6987    0.3484    0.0449    0.0159    1.3815
 *      2        1.4148    0.2744    0.0000    0.8770    1.9526
 * -------------------------------------------------------------------------- */

DROP TABLE IF EXISTS leukemia;
CREATE TABLE leukemia (
    id INTEGER NOT NULL,
    grp DOUBLE PRECISION,
    wbc DOUBLE PRECISION,
    timeDeath INTEGER,
    CONSTRAINT pk_leukemia PRIMARY key (id)
);


INSERT INTO leukemia(id, grp, wbc, timeDeath) VALUES
(1,0,1.45,35),
(2,0,1.47,34),
(3,0,2.2,32),
(4,0,1.78,25),
(5,0,2.57,23),
(6,0,2.32,22),
(7,0,2.01,20),
(8,0,2.05,19),
(9,0,2.16,17),
(10,0,3.6,16),
(11,1,2.3,15),
(12,0,2.88,13),
(13,1,1.5,12),
(14,0,2.6,11),
(15,0,2.7,10),
(16,0,2.8,9),
(17,1,2.32,8),
(18,0,4.43,7),
(19,0,2.31,6),
(20,1,3.49,5),
(21,1,2.42,4),
(22,1,4.01,3),
(23,1,4.91,2),
(24,1,5,1);

 
SELECT * from madlib.cox_prop_hazards(
    'leukemia', 'ARRAY[grp, wbc]', 'timeDeath', 20, 'newton',  0.001      			 
);

/* -----------------------------------------------------------------------------
* WARNING: This data is not sorted. Please sort this first!
* (1,0,1.45,35),
* (2,0,1.47,34),
* (3,0,2.2,32),
* (4,0,2.53,32),
* (5,0,1.78,25),
* (6,0,2.57,23),
* (7,0,2.32,22),
* (8,0,2.01,20),
* (9,0,2.05,19),
* (10,0,2.16,17),
* (11,0,3.6,16),
* (12,0,2.88,13),
* (13,0,2.6,11),
* (14,0,2.7,10),
* (15,0,2.96,10),
* (16,0,2.8,9),
* (17,0,4.43,7),
* (18,0,3.2,6),
* (19,0,2.31,6),
* (20,0,4.06,6),
* (21,0,3.28,6),
* (22,1,1.97,23),
* (23,1,2.73,22),
* (24,1,2.95,17),
* (25,1,2.3,15),
* (26,1,1.5,12),
* (27,1,3.06,12),
* (28,1,3.49,11),
* (29,1,2.12,11),
* (30,1,3.52,8),
* (31,1,3.05,8),
* (32,1,2.32,8),
* (33,1,3.26,8),
* (34,1,3.49,5),
* (35,1,3.97,5),
* (36,1,4.36,4),
* (37,1,2.42,4),
* (38,1,4.01,3),
* (39,1,4.91,2),
* (40,1,4.48,2),
* (41,1,2.8,1),
* (42,1,5,1);
* -------------------------------------------------------------------------- */