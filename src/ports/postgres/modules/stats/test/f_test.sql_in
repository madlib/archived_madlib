/* -----------------------------------------------------------------------------
 * Test F-test.
 * 
 * Example ("JAHANMI2.DAT") taken from:
 * http://www.itl.nist.gov/div898/handbook/eda/section3/eda359.htm
 * -------------------------------------------------------------------------- */

CREATE TABLE jahanmi2 (
	Run INTEGER,
	Lab INTEGER,
	Batch INTEGER,
	Y FLOAT8,
	X1 FLOAT8,
	X2 FLOAT8,
	X3 FLOAT8
);

COPY jahanmi2 FROM stdin;
1	1	1	608.781	-1	-1	-1
2	1	2	569.670	-1	-1	-1
3	1	1	689.556	-1	-1	-1
4	1	2	747.541	-1	-1	-1
5	1	1	618.134	-1	-1	-1
6	1	2	612.182	-1	-1	-1
7	1	1	680.203	-1	-1	-1
8	1	2	607.766	-1	-1	-1
9	1	1	726.232	-1	-1	-1
10	1	2	605.380	-1	-1	-1
11	1	1	518.655	-1	-1	-1
12	1	2	589.226	-1	-1	-1
13	1	1	740.447	-1	-1	-1
14	1	2	588.375	-1	-1	-1
15	1	1	666.830	-1	-1	-1
16	1	2	531.384	-1	-1	-1
17	1	1	710.272	-1	-1	-1
18	1	2	633.417	-1	-1	-1
19	1	1	751.669	-1	-1	-1
20	1	2	619.060	-1	-1	-1
21	1	1	697.979	-1	-1	-1
22	1	2	632.447	-1	-1	-1
23	1	1	708.583	-1	-1	-1
24	1	2	624.256	-1	-1	-1
25	1	1	624.972	-1	-1	-1
26	1	2	575.143	-1	-1	-1
27	1	1	695.070	-1	-1	-1
28	1	2	549.278	-1	-1	-1
29	1	1	769.391	-1	-1	-1
30	1	2	624.972	-1	-1	-1
61	1	1	720.186	-1	1	1
62	1	2	587.695	-1	1	1
63	1	1	723.657	-1	1	1
64	1	2	569.207	-1	1	1
65	1	1	703.700	-1	1	1
66	1	2	613.257	-1	1	1
67	1	1	697.626	-1	1	1
68	1	2	565.737	-1	1	1
69	1	1	714.980	-1	1	1
70	1	2	662.131	-1	1	1
71	1	1	657.712	-1	1	1
72	1	2	543.177	-1	1	1
73	1	1	609.989	-1	1	1
74	1	2	512.394	-1	1	1
75	1	1	650.771	-1	1	1
76	1	2	611.190	-1	1	1
77	1	1	707.977	-1	1	1
78	1	2	659.982	-1	1	1
79	1	1	712.199	-1	1	1
80	1	2	569.245	-1	1	1
81	1	1	709.631	-1	1	1
82	1	2	725.792	-1	1	1
83	1	1	703.160	-1	1	1
84	1	2	608.960	-1	1	1
85	1	1	744.822	-1	1	1
86	1	2	586.060	-1	1	1
87	1	1	719.217	-1	1	1
88	1	2	617.441	-1	1	1
89	1	1	619.137	-1	1	1
90	1	2	592.845	-1	1	1
151	2	1	753.333	1	1	1
152	2	2	631.754	1	1	1
153	2	1	677.933	1	1	1
154	2	2	588.113	1	1	1
155	2	1	735.919	1	1	1
156	2	2	555.724	1	1	1
157	2	1	695.274	1	1	1
158	2	2	702.411	1	1	1
159	2	1	504.167	1	1	1
160	2	2	631.754	1	1	1
161	2	1	693.333	1	1	1
162	2	2	698.254	1	1	1
163	2	1	625.000	1	1	1
164	2	2	616.791	1	1	1
165	2	1	596.667	1	1	1
166	2	2	551.953	1	1	1
167	2	1	640.898	1	1	1
168	2	2	636.738	1	1	1
169	2	1	720.506	1	1	1
170	2	2	571.551	1	1	1
171	2	1	700.748	1	1	1
172	2	2	521.667	1	1	1
173	2	1	691.604	1	1	1
174	2	2	587.451	1	1	1
175	2	1	636.738	1	1	1
176	2	2	700.422	1	1	1
177	2	1	731.667	1	1	1
178	2	2	595.819	1	1	1
179	2	1	635.079	1	1	1
180	2	2	534.236	1	1	1
181	2	1	716.926	1	-1	-1
182	2	2	606.188	1	-1	-1
183	2	1	759.581	1	-1	-1
184	2	2	575.303	1	-1	-1
185	2	1	673.903	1	-1	-1
186	2	2	590.628	1	-1	-1
187	2	1	736.648	1	-1	-1
188	2	2	729.314	1	-1	-1
189	2	1	675.957	1	-1	-1
190	2	2	619.313	1	-1	-1
191	2	1	729.230	1	-1	-1
192	2	2	624.234	1	-1	-1
193	2	1	697.239	1	-1	-1
194	2	2	651.304	1	-1	-1
195	2	1	728.499	1	-1	-1
196	2	2	724.175	1	-1	-1
197	2	1	797.662	1	-1	-1
198	2	2	583.034	1	-1	-1
199	2	1	668.530	1	-1	-1
200	2	2	620.227	1	-1	-1
201	2	1	815.754	1	-1	-1
202	2	2	584.861	1	-1	-1
203	2	1	777.392	1	-1	-1
204	2	2	565.391	1	-1	-1
205	2	1	712.140	1	-1	-1
206	2	2	622.506	1	-1	-1
207	2	1	663.622	1	-1	-1
208	2	2	628.336	1	-1	-1
209	2	1	684.181	1	-1	-1
210	2	2	587.145	1	-1	-1
271	3	1	629.012	1	-1	1
272	3	2	584.319	1	-1	1
273	3	1	640.193	1	-1	1
274	3	2	538.239	1	-1	1
275	3	1	644.156	1	-1	1
276	3	2	538.097	1	-1	1
277	3	1	642.469	1	-1	1
278	3	2	595.686	1	-1	1
279	3	1	639.090	1	-1	1
280	3	2	648.935	1	-1	1
281	3	1	439.418	1	-1	1
282	3	2	583.827	1	-1	1
283	3	1	614.664	1	-1	1
284	3	2	534.905	1	-1	1
285	3	1	537.161	1	-1	1
286	3	2	569.858	1	-1	1
287	3	1	656.773	1	-1	1
288	3	2	617.246	1	-1	1
289	3	1	659.534	1	-1	1
290	3	2	610.337	1	-1	1
291	3	1	695.278	1	-1	1
292	3	2	584.192	1	-1	1
293	3	1	734.040	1	-1	1
294	3	2	598.853	1	-1	1
295	3	1	687.665	1	-1	1
296	3	2	554.774	1	-1	1
297	3	1	710.858	1	-1	1
298	3	2	605.694	1	-1	1
299	3	1	701.716	1	-1	1
300	3	2	627.516	1	-1	1
301	3	1	382.133	1	1	-1
302	3	2	574.522	1	1	-1
303	3	1	719.744	1	1	-1
304	3	2	582.682	1	1	-1
305	3	1	756.820	1	1	-1
306	3	2	563.872	1	1	-1
307	3	1	690.978	1	1	-1
308	3	2	715.962	1	1	-1
309	3	1	670.864	1	1	-1
310	3	2	616.430	1	1	-1
311	3	1	670.308	1	1	-1
312	3	2	778.011	1	1	-1
313	3	1	660.062	1	1	-1
314	3	2	604.255	1	1	-1
315	3	1	790.382	1	1	-1
316	3	2	571.906	1	1	-1
317	3	1	714.750	1	1	-1
318	3	2	625.925	1	1	-1
319	3	1	716.959	1	1	-1
320	3	2	682.426	1	1	-1
321	3	1	603.363	1	1	-1
322	3	2	707.604	1	1	-1
323	3	1	713.796	1	1	-1
324	3	2	617.400	1	1	-1
325	3	1	444.963	1	1	-1
326	3	2	689.576	1	1	-1
327	3	1	723.276	1	1	-1
328	3	2	676.678	1	1	-1
329	3	1	745.527	1	1	-1
330	3	2	563.290	1	1	-1
361	4	1	778.333	-1	-1	1
362	4	2	581.879	-1	-1	1
363	4	1	723.349	-1	-1	1
364	4	2	447.701	-1	-1	1
365	4	1	708.229	-1	-1	1
366	4	2	557.772	-1	-1	1
367	4	1	681.667	-1	-1	1
368	4	2	593.537	-1	-1	1
369	4	1	566.085	-1	-1	1
370	4	2	632.585	-1	-1	1
371	4	1	687.448	-1	-1	1
372	4	2	671.350	-1	-1	1
373	4	1	597.500	-1	-1	1
374	4	2	569.530	-1	-1	1
375	4	1	637.410	-1	-1	1
376	4	2	581.667	-1	-1	1
377	4	1	755.864	-1	-1	1
378	4	2	643.449	-1	-1	1
379	4	1	692.945	-1	-1	1
380	4	2	581.593	-1	-1	1
381	4	1	766.532	-1	-1	1
382	4	2	494.122	-1	-1	1
383	4	1	725.663	-1	-1	1
384	4	2	620.948	-1	-1	1
385	4	1	698.818	-1	-1	1
386	4	2	615.903	-1	-1	1
387	4	1	760.000	-1	-1	1
388	4	2	606.667	-1	-1	1
389	4	1	775.272	-1	-1	1
390	4	2	579.167	-1	-1	1
421	4	1	708.885	-1	1	-1
422	4	2	662.510	-1	1	-1
423	4	1	727.201	-1	1	-1
424	4	2	436.237	-1	1	-1
425	4	1	642.560	-1	1	-1
426	4	2	644.223	-1	1	-1
427	4	1	690.773	-1	1	-1
428	4	2	586.035	-1	1	-1
429	4	1	688.333	-1	1	-1
430	4	2	620.833	-1	1	-1
431	4	1	743.973	-1	1	-1
432	4	2	652.535	-1	1	-1
433	4	1	682.461	-1	1	-1
434	4	2	593.516	-1	1	-1
435	4	1	761.430	-1	1	-1
436	4	2	587.451	-1	1	-1
437	4	1	691.542	-1	1	-1
438	4	2	570.964	-1	1	-1
439	4	1	643.392	-1	1	-1
440	4	2	645.192	-1	1	-1
441	4	1	697.075	-1	1	-1
442	4	2	540.079	-1	1	-1
443	4	1	708.229	-1	1	-1
444	4	2	707.117	-1	1	-1
445	4	1	746.467	-1	1	-1
446	4	2	621.779	-1	1	-1
447	4	1	744.819	-1	1	-1
448	4	2	585.777	-1	1	-1
449	4	1	655.029	-1	1	-1
450	4	2	703.980	-1	1	-1
541	5	1	715.224	-1	-1	-1
542	5	2	698.237	-1	-1	-1
543	5	1	614.417	-1	-1	-1
544	5	2	757.120	-1	-1	-1
545	5	1	761.363	-1	-1	-1
546	5	2	621.751	-1	-1	-1
547	5	1	716.106	-1	-1	-1
548	5	2	472.125	-1	-1	-1
549	5	1	659.502	-1	-1	-1
550	5	2	612.700	-1	-1	-1
551	5	1	730.781	-1	-1	-1
552	5	2	583.170	-1	-1	-1
553	5	1	546.928	-1	-1	-1
554	5	2	599.771	-1	-1	-1
555	5	1	734.203	-1	-1	-1
556	5	2	549.227	-1	-1	-1
557	5	1	682.051	-1	-1	-1
558	5	2	605.453	-1	-1	-1
559	5	1	701.341	-1	-1	-1
560	5	2	569.599	-1	-1	-1
561	5	1	759.729	-1	-1	-1
562	5	2	637.233	-1	-1	-1
563	5	1	689.942	-1	-1	-1
564	5	2	621.774	-1	-1	-1
565	5	1	769.424	-1	-1	-1
566	5	2	558.041	-1	-1	-1
567	5	1	715.286	-1	-1	-1
568	5	2	583.170	-1	-1	-1
569	5	1	776.197	-1	-1	-1
570	5	2	345.294	-1	-1	-1
571	5	1	547.099	1	-1	1
572	5	2	570.999	1	-1	1
573	5	1	619.942	1	-1	1
574	5	2	603.232	1	-1	1
575	5	1	696.046	1	-1	1
576	5	2	595.335	1	-1	1
577	5	1	573.109	1	-1	1
578	5	2	581.047	1	-1	1
579	5	1	638.794	1	-1	1
580	5	2	455.878	1	-1	1
581	5	1	708.193	1	-1	1
582	5	2	627.880	1	-1	1
583	5	1	502.825	1	-1	1
584	5	2	464.085	1	-1	1
585	5	1	632.633	1	-1	1
586	5	2	596.129	1	-1	1
587	5	1	683.382	1	-1	1
588	5	2	640.371	1	-1	1
589	5	1	684.812	1	-1	1
590	5	2	621.471	1	-1	1
591	5	1	738.161	1	-1	1
592	5	2	612.727	1	-1	1
593	5	1	671.492	1	-1	1
594	5	2	606.460	1	-1	1
595	5	1	709.771	1	-1	1
596	5	2	571.760	1	-1	1
597	5	1	685.199	1	-1	1
598	5	2	599.304	1	-1	1
599	5	1	624.973	1	-1	1
600	5	2	579.459	1	-1	1
601	6	1	757.363	1	1	1
602	6	2	761.511	1	1	1
603	6	1	633.417	1	1	1
604	6	2	566.969	1	1	1
605	6	1	658.754	1	1	1
606	6	2	654.397	1	1	1
607	6	1	664.666	1	1	1
608	6	2	611.719	1	1	1
609	6	1	663.009	1	1	1
610	6	2	577.409	1	1	1
611	6	1	773.226	1	1	1
612	6	2	576.731	1	1	1
613	6	1	708.261	1	1	1
614	6	2	617.441	1	1	1
615	6	1	739.086	1	1	1
616	6	2	577.409	1	1	1
617	6	1	667.786	1	1	1
618	6	2	548.957	1	1	1
619	6	1	674.481	1	1	1
620	6	2	623.315	1	1	1
621	6	1	695.688	1	1	1
622	6	2	621.761	1	1	1
623	6	1	588.288	1	1	1
624	6	2	553.978	1	1	1
625	6	1	545.610	1	1	1
626	6	2	657.157	1	1	1
627	6	1	752.305	1	1	1
628	6	2	610.882	1	1	1
629	6	1	684.523	1	1	1
630	6	2	552.304	1	1	1
631	6	1	717.159	-1	1	-1
632	6	2	545.303	-1	1	-1
633	6	1	721.343	-1	1	-1
634	6	2	651.934	-1	1	-1
635	6	1	750.623	-1	1	-1
636	6	2	635.240	-1	1	-1
637	6	1	776.488	-1	1	-1
638	6	2	641.083	-1	1	-1
639	6	1	750.623	-1	1	-1
640	6	2	645.321	-1	1	-1
641	6	1	600.840	-1	1	-1
642	6	2	566.127	-1	1	-1
643	6	1	686.196	-1	1	-1
644	6	2	647.844	-1	1	-1
645	6	1	687.870	-1	1	-1
646	6	2	554.815	-1	1	-1
647	6	1	725.527	-1	1	-1
648	6	2	620.087	-1	1	-1
649	6	1	658.796	-1	1	-1
650	6	2	711.301	-1	1	-1
651	6	1	690.380	-1	1	-1
652	6	2	644.355	-1	1	-1
653	6	1	737.144	-1	1	-1
654	6	2	713.812	-1	1	-1
655	6	1	663.851	-1	1	-1
656	6	2	696.707	-1	1	-1
657	6	1	766.630	-1	1	-1
658	6	2	589.453	-1	1	-1
659	6	1	625.922	-1	1	-1
660	6	2	634.468	-1	1	-1
721	7	1	694.430	1	1	-1
722	7	2	599.751	1	1	-1
723	7	1	730.217	1	1	-1
724	7	2	624.542	1	1	-1
725	7	1	700.770	1	1	-1
726	7	2	723.505	1	1	-1
727	7	1	722.242	1	1	-1
728	7	2	674.717	1	1	-1
729	7	1	763.828	1	1	-1
730	7	2	608.539	1	1	-1
731	7	1	695.668	1	1	-1
732	7	2	612.135	1	1	-1
733	7	1	688.887	1	1	-1
734	7	2	591.935	1	1	-1
735	7	1	531.021	1	1	-1
736	7	2	676.656	1	1	-1
737	7	1	698.915	1	1	-1
738	7	2	647.323	1	1	-1
739	7	1	735.905	1	1	-1
740	7	2	811.970	1	1	-1
741	7	1	732.039	1	1	-1
742	7	2	603.883	1	1	-1
743	7	1	751.832	1	1	-1
744	7	2	608.643	1	1	-1
745	7	1	618.663	1	1	-1
746	7	2	630.778	1	1	-1
747	7	1	744.845	1	1	-1
748	7	2	623.063	1	1	-1
749	7	1	690.826	1	1	-1
750	7	2	472.463	1	1	-1
811	7	1	666.893	-1	1	1
812	7	2	645.932	-1	1	1
813	7	1	759.860	-1	1	1
814	7	2	577.176	-1	1	1
815	7	1	683.752	-1	1	1
816	7	2	567.530	-1	1	1
817	7	1	729.591	-1	1	1
818	7	2	821.654	-1	1	1
819	7	1	730.706	-1	1	1
820	7	2	684.490	-1	1	1
821	7	1	763.124	-1	1	1
822	7	2	600.427	-1	1	1
823	7	1	724.193	-1	1	1
824	7	2	686.023	-1	1	1
825	7	1	630.352	-1	1	1
826	7	2	628.109	-1	1	1
827	7	1	750.338	-1	1	1
828	7	2	605.214	-1	1	1
829	7	1	752.417	-1	1	1
830	7	2	640.260	-1	1	1
831	7	1	707.899	-1	1	1
832	7	2	700.767	-1	1	1
833	7	1	715.582	-1	1	1
834	7	2	665.924	-1	1	1
835	7	1	728.746	-1	1	1
836	7	2	555.926	-1	1	1
837	7	1	591.193	-1	1	1
838	7	2	543.299	-1	1	1
839	7	1	592.252	-1	1	1
840	7	2	511.030	-1	1	1
901	8	1	740.833	-1	-1	1
902	8	2	583.994	-1	-1	1
903	8	1	786.367	-1	-1	1
904	8	2	611.048	-1	-1	1
905	8	1	712.386	-1	-1	1
906	8	2	623.338	-1	-1	1
907	8	1	738.333	-1	-1	1
908	8	2	679.585	-1	-1	1
909	8	1	741.480	-1	-1	1
910	8	2	665.004	-1	-1	1
911	8	1	729.167	-1	-1	1
912	8	2	655.860	-1	-1	1
913	8	1	795.833	-1	-1	1
914	8	2	715.711	-1	-1	1
915	8	1	723.502	-1	-1	1
916	8	2	611.999	-1	-1	1
917	8	1	718.333	-1	-1	1
918	8	2	577.722	-1	-1	1
919	8	1	768.080	-1	-1	1
920	8	2	615.129	-1	-1	1
921	8	1	747.500	-1	-1	1
922	8	2	540.316	-1	-1	1
923	8	1	775.000	-1	-1	1
924	8	2	711.667	-1	-1	1
925	8	1	760.599	-1	-1	1
926	8	2	639.167	-1	-1	1
927	8	1	758.333	-1	-1	1
928	8	2	549.491	-1	-1	1
929	8	1	682.500	-1	-1	1
930	8	2	684.167	-1	-1	1
931	8	1	658.116	1	-1	-1
932	8	2	672.153	1	-1	-1
933	8	1	738.213	1	-1	-1
934	8	2	594.534	1	-1	-1
935	8	1	681.236	1	-1	-1
936	8	2	627.650	1	-1	-1
937	8	1	704.904	1	-1	-1
938	8	2	551.870	1	-1	-1
939	8	1	693.623	1	-1	-1
940	8	2	594.534	1	-1	-1
941	8	1	624.993	1	-1	-1
942	8	2	602.660	1	-1	-1
943	8	1	700.228	1	-1	-1
944	8	2	585.450	1	-1	-1
945	8	1	611.874	1	-1	-1
946	8	2	555.724	1	-1	-1
947	8	1	579.167	1	-1	-1
948	8	2	574.934	1	-1	-1
949	8	1	720.872	1	-1	-1
950	8	2	584.625	1	-1	-1
951	8	1	690.320	1	-1	-1
952	8	2	555.724	1	-1	-1
953	8	1	677.933	1	-1	-1
954	8	2	611.874	1	-1	-1
955	8	1	674.600	1	-1	-1
956	8	2	698.254	1	-1	-1
957	8	1	611.999	1	-1	-1
958	8	2	748.130	1	-1	-1
959	8	1	530.680	1	-1	-1
960	8	2	689.942	1	-1	-1
\.

CREATE TABLE f_test AS
SELECT (f_test((2 - batch)::BOOLEAN, y)).* FROM jahanmi2;

SELECT * FROM f_test;
SELECT assert(
    relative_error(statistic, 1.123037) < 0.001 AND
    df1 = 239 AND
    df2 = 239 AND
    relative_error(p_value_one_sided, 1. - 0.814808) < 0.001,
    'F-test: Wrong results'
) FROM f_test;
