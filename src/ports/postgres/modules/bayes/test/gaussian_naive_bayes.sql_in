-- The data were collected by Anderson, Edgar (1935).
-- The irises of the Gaspe Peninsula, Bulletin of the American Iris Society, 59, 2â€“5.
DROP TABLE IF EXISTS iris_data, iris_test CASCADE;
CREATE TABLE iris_data(
    id integer,
    attributes numeric[],
    class_text varchar,
    class integer
);

CREATE TABLE iris_test(
    id integer,
    attributes numeric[],
    class_text varchar,
    class integer
);

INSERT INTO iris_data VALUES
(1,ARRAY[5.1,3.5,1.4,0.2],'Iris-setosa',1),
(2,ARRAY[4.9,3.0,1.4,0.2],'Iris-setosa',1),
(3,ARRAY[4.7,3.2,1.3,0.2],'Iris-setosa',1),
(4,ARRAY[4.6,3.1,1.5,0.2],'Iris-setosa',1),
(5,ARRAY[5.0,3.6,1.4,0.2],'Iris-setosa',1),
(6,ARRAY[5.4,3.9,1.7,0.4],'Iris-setosa',1),
(7,ARRAY[4.6,3.4,1.4,0.3],'Iris-setosa',1),
(8,ARRAY[5.0,3.4,1.5,0.2],'Iris-setosa',1),
(9,ARRAY[4.4,2.9,1.4,0.2],'Iris-setosa',1),
(10,ARRAY[4.9,3.1,1.5,0.1],'Iris-setosa',1),
(11,ARRAY[5.4,3.7,1.5,0.2],'Iris-setosa',1),
(12,ARRAY[4.8,3.4,1.6,0.2],'Iris-setosa',1),
(13,ARRAY[4.8,3.0,1.4,0.1],'Iris-setosa',1),
(14,ARRAY[4.3,3.0,1.1,0.1],'Iris-setosa',1),
(15,ARRAY[5.8,4.0,1.2,0.2],'Iris-setosa',1),
(16,ARRAY[5.7,4.4,1.5,0.4],'Iris-setosa',1),
(17,ARRAY[5.4,3.9,1.3,0.4],'Iris-setosa',1),
(18,ARRAY[5.1,3.5,1.4,0.3],'Iris-setosa',1),
(19,ARRAY[5.7,3.8,1.7,0.3],'Iris-setosa',1),
(20,ARRAY[5.1,3.8,1.5,0.3],'Iris-setosa',1),
(21,ARRAY[5.4,3.4,1.7,0.2],'Iris-setosa',1),
(22,ARRAY[5.1,3.7,1.5,0.4],'Iris-setosa',1),
(23,ARRAY[4.6,3.6,1.0,0.2],'Iris-setosa',1),
(24,ARRAY[5.1,3.3,1.7,0.5],'Iris-setosa',1),
(25,ARRAY[4.8,3.4,1.9,0.2],'Iris-setosa',1),
(26,ARRAY[5.0,3.0,1.6,0.2],'Iris-setosa',1),
(27,ARRAY[5.0,3.4,1.6,0.4],'Iris-setosa',1),
(28,ARRAY[5.2,3.5,1.5,0.2],'Iris-setosa',1),
(29,ARRAY[5.2,3.4,1.4,0.2],'Iris-setosa',1),
(30,ARRAY[4.7,3.2,1.6,0.2],'Iris-setosa',1),
(31,ARRAY[4.8,3.1,1.6,0.2],'Iris-setosa',1),
(32,ARRAY[5.4,3.4,1.5,0.4],'Iris-setosa',1),
(33,ARRAY[5.2,4.1,1.5,0.1],'Iris-setosa',1),
(34,ARRAY[5.5,4.2,1.4,0.2],'Iris-setosa',1),
(35,ARRAY[4.9,3.1,1.5,0.1],'Iris-setosa',1),
(36,ARRAY[5.0,3.2,1.2,0.2],'Iris-setosa',1),
(37,ARRAY[5.5,3.5,1.3,0.2],'Iris-setosa',1),
(38,ARRAY[4.9,3.1,1.5,0.1],'Iris-setosa',1),
(39,ARRAY[4.4,3.0,1.3,0.2],'Iris-setosa',1),
(40,ARRAY[5.1,3.4,1.5,0.2],'Iris-setosa',1),
(41,ARRAY[5.0,3.5,1.3,0.3],'Iris-setosa',1),
(42,ARRAY[4.5,2.3,1.3,0.3],'Iris-setosa',1),
(43,ARRAY[4.4,3.2,1.3,0.2],'Iris-setosa',1),
(44,ARRAY[5.0,3.5,1.6,0.6],'Iris-setosa',1),
(45,ARRAY[5.1,3.8,1.9,0.4],'Iris-setosa',1),
(46,ARRAY[4.8,3.0,1.4,0.3],'Iris-setosa',1),
(47,ARRAY[5.1,3.8,1.6,0.2],'Iris-setosa',1),
(48,ARRAY[4.6,3.2,1.4,0.2],'Iris-setosa',1),
(49,ARRAY[5.3,3.7,1.5,0.2],'Iris-setosa',1),
(50,ARRAY[5.0,3.3,1.4,0.2],'Iris-setosa',1),
(51,ARRAY[7.0,3.2,4.7,1.4],'Iris-versicolor',2),
(52,ARRAY[6.4,3.2,4.5,1.5],'Iris-versicolor',2),
(53,ARRAY[6.9,3.1,4.9,1.5],'Iris-versicolor',2),
(54,ARRAY[5.5,2.3,4.0,1.3],'Iris-versicolor',2),
(55,ARRAY[6.5,2.8,4.6,1.5],'Iris-versicolor',2),
(56,ARRAY[5.7,2.8,4.5,1.3],'Iris-versicolor',2),
(57,ARRAY[6.3,3.3,4.7,1.6],'Iris-versicolor',2),
(58,ARRAY[4.9,2.4,3.3,1.0],'Iris-versicolor',2),
(59,ARRAY[6.6,2.9,4.6,1.3],'Iris-versicolor',2),
(60,ARRAY[5.2,2.7,3.9,1.4],'Iris-versicolor',2),
(61,ARRAY[5.0,2.0,3.5,1.0],'Iris-versicolor',2),
(62,ARRAY[5.9,3.0,4.2,1.5],'Iris-versicolor',2),
(63,ARRAY[6.0,2.2,4.0,1.0],'Iris-versicolor',2),
(64,ARRAY[6.1,2.9,4.7,1.4],'Iris-versicolor',2),
(65,ARRAY[5.6,2.9,3.6,1.3],'Iris-versicolor',2),
(66,ARRAY[6.7,3.1,4.4,1.4],'Iris-versicolor',2),
(67,ARRAY[5.6,3.0,4.5,1.5],'Iris-versicolor',2),
(68,ARRAY[5.8,2.7,4.1,1.0],'Iris-versicolor',2),
(69,ARRAY[6.2,2.2,4.5,1.5],'Iris-versicolor',2),
(70,ARRAY[5.6,2.5,3.9,1.1],'Iris-versicolor',2),
(71,ARRAY[5.9,3.2,4.8,1.8],'Iris-versicolor',2),
(72,ARRAY[6.1,2.8,4.0,1.3],'Iris-versicolor',2),
(73,ARRAY[6.3,2.5,4.9,1.5],'Iris-versicolor',2),
(74,ARRAY[6.1,2.8,4.7,1.2],'Iris-versicolor',2),
(75,ARRAY[6.4,2.9,4.3,1.3],'Iris-versicolor',2),
(76,ARRAY[6.6,3.0,4.4,1.4],'Iris-versicolor',2),
(77,ARRAY[6.8,2.8,4.8,1.4],'Iris-versicolor',2),
(78,ARRAY[6.7,3.0,5.0,1.7],'Iris-versicolor',2),
(79,ARRAY[6.0,2.9,4.5,1.5],'Iris-versicolor',2),
(80,ARRAY[5.7,2.6,3.5,1.0],'Iris-versicolor',2),
(81,ARRAY[5.5,2.4,3.8,1.1],'Iris-versicolor',2),
(82,ARRAY[5.5,2.4,3.7,1.0],'Iris-versicolor',2),
(83,ARRAY[5.8,2.7,3.9,1.2],'Iris-versicolor',2),
(84,ARRAY[6.0,2.7,5.1,1.6],'Iris-versicolor',2),
(85,ARRAY[5.4,3.0,4.5,1.5],'Iris-versicolor',2),
(86,ARRAY[6.0,3.4,4.5,1.6],'Iris-versicolor',2),
(87,ARRAY[6.7,3.1,4.7,1.5],'Iris-versicolor',2),
(88,ARRAY[6.3,2.3,4.4,1.3],'Iris-versicolor',2),
(89,ARRAY[5.6,3.0,4.1,1.3],'Iris-versicolor',2),
(90,ARRAY[5.5,2.5,4.0,1.3],'Iris-versicolor',2),
(91,ARRAY[5.5,2.6,4.4,1.2],'Iris-versicolor',2),
(92,ARRAY[6.1,3.0,4.6,1.4],'Iris-versicolor',2),
(93,ARRAY[5.8,2.6,4.0,1.2],'Iris-versicolor',2),
(94,ARRAY[5.0,2.3,3.3,1.0],'Iris-versicolor',2),
(95,ARRAY[5.6,2.7,4.2,1.3],'Iris-versicolor',2),
(96,ARRAY[5.7,3.0,4.2,1.2],'Iris-versicolor',2),
(97,ARRAY[5.7,2.9,4.2,1.3],'Iris-versicolor',2),
(98,ARRAY[6.2,2.9,4.3,1.3],'Iris-versicolor',2),
(99,ARRAY[5.1,2.5,3.0,1.1],'Iris-versicolor',2),
(100,ARRAY[5.7,2.8,4.1,1.3],'Iris-versicolor',2),
(101,ARRAY[6.3,3.3,6.0,2.5],'Iris-virginica',3),
(102,ARRAY[5.8,2.7,5.1,1.9],'Iris-virginica',3),
(103,ARRAY[7.1,3.0,5.9,2.1],'Iris-virginica',3),
(104,ARRAY[6.3,2.9,5.6,1.8],'Iris-virginica',3),
(105,ARRAY[6.5,3.0,5.8,2.2],'Iris-virginica',3),
(106,ARRAY[7.6,3.0,6.6,2.1],'Iris-virginica',3),
(107,ARRAY[4.9,2.5,4.5,1.7],'Iris-virginica',3),
(108,ARRAY[7.3,2.9,6.3,1.8],'Iris-virginica',3),
(109,ARRAY[6.7,2.5,5.8,1.8],'Iris-virginica',3),
(110,ARRAY[7.2,3.6,6.1,2.5],'Iris-virginica',3),
(111,ARRAY[6.5,3.2,5.1,2.0],'Iris-virginica',3),
(112,ARRAY[6.4,2.7,5.3,1.9],'Iris-virginica',3),
(113,ARRAY[6.8,3.0,5.5,2.1],'Iris-virginica',3),
(114,ARRAY[5.7,2.5,5.0,2.0],'Iris-virginica',3),
(115,ARRAY[5.8,2.8,5.1,2.4],'Iris-virginica',3),
(116,ARRAY[6.4,3.2,5.3,2.3],'Iris-virginica',3),
(117,ARRAY[6.5,3.0,5.5,1.8],'Iris-virginica',3),
(118,ARRAY[7.7,3.8,6.7,2.2],'Iris-virginica',3),
(119,ARRAY[7.7,2.6,6.9,2.3],'Iris-virginica',3),
(120,ARRAY[6.0,2.2,5.0,1.5],'Iris-virginica',3),
(121,ARRAY[6.9,3.2,5.7,2.3],'Iris-virginica',3),
(122,ARRAY[5.6,2.8,4.9,2.0],'Iris-virginica',3),
(123,ARRAY[7.7,2.8,6.7,2.0],'Iris-virginica',3),
(124,ARRAY[6.3,2.7,4.9,1.8],'Iris-virginica',3),
(125,ARRAY[6.7,3.3,5.7,2.1],'Iris-virginica',3),
(126,ARRAY[7.2,3.2,6.0,1.8],'Iris-virginica',3),
(127,ARRAY[6.2,2.8,4.8,1.8],'Iris-virginica',3),
(128,ARRAY[6.1,3.0,4.9,1.8],'Iris-virginica',3),
(129,ARRAY[6.4,2.8,5.6,2.1],'Iris-virginica',3),
(130,ARRAY[7.2,3.0,5.8,1.6],'Iris-virginica',3),
(131,ARRAY[7.4,2.8,6.1,1.9],'Iris-virginica',3),
(132,ARRAY[7.9,3.8,6.4,2.0],'Iris-virginica',3),
(133,ARRAY[6.4,2.8,5.6,2.2],'Iris-virginica',3),
(134,ARRAY[6.3,2.8,5.1,1.5],'Iris-virginica',3),
(135,ARRAY[6.1,2.6,5.6,1.4],'Iris-virginica',3),
(136,ARRAY[7.7,3.0,6.1,2.3],'Iris-virginica',3),
(137,ARRAY[6.3,3.4,5.6,2.4],'Iris-virginica',3),
(138,ARRAY[6.4,3.1,5.5,1.8],'Iris-virginica',3),
(139,ARRAY[6.0,3.0,4.8,1.8],'Iris-virginica',3),
(140,ARRAY[6.9,3.1,5.4,2.1],'Iris-virginica',3),
(141,ARRAY[6.7,3.1,5.6,2.4],'Iris-virginica',3),
(142,ARRAY[6.9,3.1,5.1,2.3],'Iris-virginica',3),
(143,ARRAY[5.8,2.7,5.1,1.9],'Iris-virginica',3),
(144,ARRAY[6.8,3.2,5.9,2.3],'Iris-virginica',3),
(145,ARRAY[6.7,3.3,5.7,2.5],'Iris-virginica',3),
(146,ARRAY[6.7,3.0,5.2,2.3],'Iris-virginica',3),
(147,ARRAY[6.3,2.5,5.0,1.9],'Iris-virginica',3),
(148,ARRAY[6.5,3.0,5.2,2.0],'Iris-virginica',3),
(149,ARRAY[6.2,3.4,5.4,2.3],'Iris-virginica',3),
(150,ARRAY[5.9,3.0,5.1,1.8],'Iris-virginica',3);

INSERT INTO iris_test VALUES
(1,ARRAY[5.1,3.5,1.4,0.2],'Iris-setosa',1),
(18,ARRAY[5.1,3.5,1.4,0.3],'Iris-setosa',1),
(28,ARRAY[5.2,3.5,1.5,0.2],'Iris-setosa',1),
(38,ARRAY[4.9,3.1,1.5,0.1],'Iris-setosa',1),
(86,ARRAY[6.0,3.4,4.5,1.6],'Iris-versicolor',2),
(87,ARRAY[6.7,3.1,4.7,1.5],'Iris-versicolor',2),
(88,ARRAY[6.3,2.3,4.4,1.3],'Iris-versicolor',2),
(113,ARRAY[6.8,3.0,5.5,2.1],'Iris-virginica',3),
(136,ARRAY[7.7,3.0,6.1,2.3],'Iris-virginica',3),
(143,ARRAY[5.8,2.7,5.1,1.9],'Iris-virginica',3);

-----------------------------
DROP TABLE IF EXISTS iris_class, iris_features, iris_num_features,
    iris_clasif, iris_probs CASCADE;

SELECT create_nb_prepared_data_tables(
    'iris_data',
    'class',
    'attributes',
    'ARRAY[1,2,3,4]',
    4,
    'iris_features',
    'iris_num_features',
    'iris_class'
);

SELECT create_nb_classify_view(
    'iris_features',
    'iris_class',
    'iris_test',
    'id',
    'attributes',
    4,
    'iris_num_features',
    'iris_clasif'
);

SELECT create_nb_probs_view(
    'iris_features',
    'iris_class',
    'iris_test',
    'id',
    'attributes',
    4,
    'iris_num_features',
    'iris_probs'
);

SELECT assert(count(*) = 10, 'Gaussian Naive Bayes produces wrong classes!')
FROM iris_clasif, iris_test
WHERE key = id
  AND class = nb_classification[1];

SELECT
    assert(
        relative_error(nb_prob, 0.797179533206787) < 1e-6,
        'Gaussian Naive Bayes produces probabilities')
FROM iris_probs
WHERE key = 87
  AND class = 2;

